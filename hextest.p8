pico-8 cartridge // http://www.pico-8.com
version 35
__lua__
function _init()
	poke(0x5f2d, 1)
	log("kurwa",true)
	debug={}


	hexes={}
	cam_x,cam_y=0,0
	mx,my=0,0

	--hex array in axial coordinates
	for q=0,20 do
		for r=0,10 do
		 add(hexes,{q=q,r=r})
		end
	end
end

function round(val)
	return flr(val+.5)
end

function h2p(hex)
	local x = hex.q*12
	local y = hex.r*14+hex.q*7
	return {x=x,y=y}
end

function get_hexp()
	--finds hex closest to mouse
	local mindist,minp,d,p=32767
	for h in all(hexes) do
		p=h2p(h)
		--bit shift to prevent dist overflow
		d=dist(cmx>>5,cmy>>5,p.x>>5,p.y>>5)
		--prevent hex selection on edge
		d=d<0.034 and d or 32767
		if d<mindist then
			mindist,minp=d,p
		end
	end
	return minp
end

function _update60()
	--move camera with arrows
 if btn(➡️) then
 	cam_x+=1
 end
 if btn(⬅️) then
 	cam_x-=1
 end
 if btn(⬆️) then
 	cam_y-=1
 end
 if btn(⬇️) then
 	cam_y+=1
 end

 mx,my=stat(32),stat(33)
 cmx,cmy=cam_x+mx,cam_y+my
end

function _draw()
	--clear screen
	cls(12)

	--draw hex grid
	camera(cam_x,cam_y)
	for h in all(hexes) do
		local p=h2p(h)
 	spr(1,p.x-7,p.y-7,2,2)
  --pset(p.x,p.y,8)
	end


	--draw selected hex
	hexp=get_hexp()
 if(hexp)spr(3+flr(sin(t()*2)+1)*2,hexp.x-7,hexp.y-7,2,2)

	camera()

	--draw mouse
	spr(15,mx,my)
	--debug
	do_debug()
end
-->8
function log(t,over)
	printh(t,"log",over or false)
end

function do_debug()
	draw_debug()
end

function draw_debug()
	local y=8
	for txt in all(debug) do
		print(txt,5,y,8)
		y+=6
	end
end

function dist(fx,fy,tx,ty)
	--pythagorean distance between two points
	return (fx-tx)^2+(fy-ty)^2
end

__gfx__
0000000000033333333330000003388338833000000883388338800000000000000000000000000000000000000000000000000000000000af00000001000000
000000000003bbbbbbbb30000008bbbbbbbb80000003bbbbbbbb300000000000000000000000000000000000000000000000000000000000f800000017100000
00700700003bbbbbbbbbb300008bbbbbbbbbb800008bbbbbbbbbb800000000000000000000000000000000000000000000000000000000000080000017710000
00077000003bbbbbbbbbb300003bbbbbbbbbb300008bbbbbbbbbb800000000000000000000000000000000000000000000000000000000000008000017771000
0007700003bbbbbbbbbbbb3003bbbbbbbbbbbb3003bbbbbbbbbbbb30000000000000000000000000000000000000000000000000000000000000000017777100
0070070003bbbbbbbbbbbb3008bbbbbbbbbbbb8003bbbbbbbbbbbb30000000000000000000000000000000000000000000000000000000000000000017711000
000000003bbbbbbbbbbbbbb38bbbbbbbbbbbbbb88bbbbbbbbbbbbbb8000000000000000000000000000000000000000000000000000000000000000001171000
000000003bbbbbbbbbbbbbb33bbbbbbbbbbbbbb38bbbbbbbbbbbbbb8000000000000000000000000000000000000000000000000000000000000000000000000
000000003bbbbbbbbbbbbbb38bbbbbbbbbbbbbb88bbbbbbbbbbbbbb8000000000000000000000000000000000000000000000000000000000000000000000000
0000000003bbbbbbbbbbbb3008bbbbbbbbbbbb8003bbbbbbbbbbbb30000000000000000000000000000000000000000000000000000000000000000000000000
0000000003bbbbbbbbbbbb3003bbbbbbbbbbbb3003bbbbbbbbbbbb30000000000000000000000000000000000000000000000000000000000000000000000000
00000000003bbbbbbbbbb300003bbbbbbbbbb300008bbbbbbbbbb800000000000000000000000000000000000000000000000000000000000000000000000000
00000000003bbbbbbbbbb300008bbbbbbbbbb800008bbbbbbbbbb800000000000000000000000000000000000000000000000000000000000000000000000000
000000000003bbbbbbbb30000008bbbbbbbb80000003bbbbbbbb3000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000333333333300000033883388330000008833883388000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000a0033333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000038b8b8b8b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000a03ab8b8b8b8a3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000003a8b8b8b8ba3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000a3bab8b8b8b8a8300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000038a8b8b8b8bab300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000a8bab8b8b8b8a8b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000002b2a2b228b8bab830000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000038bab8b8b8b8a8b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000038a8b8b8b8bab300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000003bab8b8b8b8a8300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000003a8b8b8b8ba3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000003ab8b8b8b8a3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000038b8b8b8b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000033333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
